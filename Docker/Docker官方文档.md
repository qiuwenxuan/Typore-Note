# ğŸ‰Docker ç®€ä»‹å’Œå®‰è£…

### Docker æ˜¯ä»€ä¹ˆ

Docker æ˜¯ä¸€ä¸ªåº”ç”¨æ‰“åŒ…ã€åˆ†å‘ã€éƒ¨ç½²çš„å·¥å…·
ä½ ä¹Ÿå¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ªè½»é‡çš„`è™šæ‹Ÿæœº`ï¼Œå®ƒåªè™šæ‹Ÿä½ è½¯ä»¶éœ€è¦çš„è¿è¡Œç¯å¢ƒï¼Œå¤šä½™çš„ä¸€ç‚¹éƒ½ä¸è¦ï¼Œ
è€Œæ™®é€šè™šæ‹Ÿæœºåˆ™æ˜¯ä¸€ä¸ªå®Œæ•´è€Œåºå¤§çš„ç³»ç»Ÿï¼ŒåŒ…å«å„ç§ä¸ç®¡ä½ è¦ä¸è¦çš„è½¯ä»¶ã€‚

> æœ¬æ–‡æ¡£è¯¾ä»¶é…å¥— [è§†é¢‘æ•™ç¨‹](https://www.bilibili.com/video/BV11L411g7U1)

### è·Ÿæ™®é€šè™šæ‹Ÿæœºçš„å¯¹æ¯”

| ç‰¹æ€§   | æ™®é€šè™šæ‹Ÿæœº                                                   | Docker                                               |
| ------ | ------------------------------------------------------------ | ---------------------------------------------------- |
| è·¨å¹³å° | é€šå¸¸`åªèƒ½åœ¨æ¡Œé¢çº§ç³»ç»Ÿ`è¿è¡Œï¼Œä¾‹å¦‚ Windows/Macï¼Œæ— æ³•åœ¨ä¸å¸¦å›¾å½¢ç•Œé¢çš„æœåŠ¡å™¨ä¸Šè¿è¡Œ | æ”¯æŒçš„ç³»ç»Ÿéå¸¸å¤šï¼Œå„ç±» windows å’Œ Linux éƒ½æ”¯æŒ       |
| æ€§èƒ½   | æ€§èƒ½æŸè€—å¤§ï¼Œå†…å­˜å ç”¨é«˜ï¼Œå› ä¸ºæ˜¯æŠŠæ•´ä¸ªå®Œæ•´ç³»ç»Ÿéƒ½è™šæ‹Ÿå‡ºæ¥äº†     | æ€§èƒ½å¥½ï¼Œåªè™šæ‹Ÿè½¯ä»¶æ‰€éœ€è¿è¡Œç¯å¢ƒï¼Œæœ€å¤§åŒ–å‡å°‘æ²¡ç”¨çš„é…ç½® |
| è‡ªåŠ¨åŒ– | éœ€è¦æ‰‹åŠ¨å®‰è£…æ‰€æœ‰ä¸œè¥¿                                         | ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥è‡ªåŠ¨éƒ¨ç½²å¥½æ‰€éœ€ç¯å¢ƒ                     |
| ç¨³å®šæ€§ | ç¨³å®šæ€§ä¸é«˜ï¼Œä¸åŒç³»ç»Ÿå·®å¼‚å¤§                                   | ç¨³å®šæ€§å¥½ï¼Œä¸åŒç³»ç»Ÿéƒ½ä¸€æ ·éƒ¨ç½²æ–¹å¼                     |

### æ‰“åŒ…ã€åˆ†å‘ã€éƒ¨ç½²

- **æ‰“åŒ…**ï¼šå°±æ˜¯æŠŠä½ è½¯ä»¶è¿è¡Œæ‰€éœ€çš„ä¾èµ–ã€ç¬¬ä¸‰æ–¹åº“ã€è½¯ä»¶æ‰“åŒ…åˆ°ä¸€èµ·ï¼Œå˜æˆä¸€ä¸ªå®‰è£…åŒ…
- **åˆ†å‘**ï¼šä½ å¯ä»¥æŠŠä½ æ‰“åŒ…å¥½çš„â€œå®‰è£…åŒ…â€ä¸Šä¼ åˆ°ä¸€ä¸ªé•œåƒä»“åº“ï¼Œå…¶ä»–äººå¯ä»¥éå¸¸æ–¹ä¾¿çš„è·å–å’Œå®‰è£…
- **éƒ¨ç½²**ï¼šæ‹¿ç€â€œå®‰è£…åŒ…â€å°±å¯ä»¥ä¸€ä¸ªå‘½ä»¤è¿è¡Œèµ·æ¥ä½ çš„åº”ç”¨ï¼Œè‡ªåŠ¨æ¨¡æ‹Ÿå‡ºä¸€æ‘¸ä¸€æ ·çš„è¿è¡Œç¯å¢ƒï¼Œä¸ç®¡æ˜¯åœ¨ Windows/Mac/Linuxã€‚
- ![image.png](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/kv7rlicu.png)

### Docker éƒ¨ç½²çš„ä¼˜åŠ¿

å¸¸è§„åº”ç”¨å¼€å‘éƒ¨ç½²æ–¹å¼ï¼šè‡ªå·±åœ¨ Windows ä¸Šå¼€å‘ã€æµ‹è¯• --> åˆ° Linux æœåŠ¡å™¨é…ç½®è¿è¡Œç¯å¢ƒéƒ¨ç½²ã€‚

> é—®é¢˜ï¼šæˆ‘æœºå™¨ä¸Šè·‘éƒ½æ²¡é—®é¢˜ï¼Œæ€ä¹ˆåˆ°æœåŠ¡å™¨å°±å„ç§é—®é¢˜äº†

ç”¨ Docker å¼€å‘éƒ¨ç½²æµç¨‹ï¼šè‡ªå·±åœ¨ Windows ä¸Šå¼€å‘ã€æµ‹è¯• --> æ‰“åŒ…ä¸º Docker é•œåƒï¼ˆå¯ä»¥ç†è§£ä¸ºè½¯ä»¶å®‰è£…åŒ…ï¼‰ --> å„ç§æœåŠ¡å™¨ä¸Šåªéœ€è¦ä¸€ä¸ªå‘½ä»¤éƒ¨ç½²å¥½

> ä¼˜ç‚¹ï¼šç¡®ä¿äº†ä¸åŒæœºå™¨ä¸Šè·‘éƒ½æ˜¯ä¸€è‡´çš„è¿è¡Œç¯å¢ƒï¼Œä¸ä¼šå‡ºç°æˆ‘æœºå™¨ä¸Šè·‘æ­£å¸¸ï¼Œä½ æœºå™¨è·‘å°±æœ‰é—®é¢˜çš„æƒ…å†µã€‚

ä¾‹å¦‚ [æ˜“æ–‡æ¡£](https://easydoc.net/)ï¼Œ[SVNBucket](https://svnbucket.com/) çš„ç§æœ‰åŒ–éƒ¨ç½²å°±æ˜¯ç”¨ Dockerï¼Œè½»æ¾åº”å¯¹å®¢æˆ·çš„å„ç§æœåŠ¡å™¨ã€‚

### Docker é€šå¸¸ç”¨æ¥åšä»€ä¹ˆ

- åº”ç”¨åˆ†å‘ã€éƒ¨ç½²ï¼Œæ–¹ä¾¿ä¼ æ’­ç»™ä»–äººå®‰è£…ã€‚ç‰¹åˆ«æ˜¯å¼€æºè½¯ä»¶å’Œæä¾›ç§æœ‰éƒ¨ç½²çš„åº”ç”¨
- å¿«é€Ÿå®‰è£…æµ‹è¯•/å­¦ä¹ è½¯ä»¶ï¼Œç”¨å®Œå°±ä¸¢ï¼ˆç±»ä¼¼å°ç¨‹åºï¼‰ï¼Œä¸æŠŠæ—¶é—´æµªè´¹åœ¨å®‰è£…è½¯ä»¶ä¸Šã€‚ä¾‹å¦‚ Redis / MongoDB / ElasticSearch / ELK
- å¤šä¸ªç‰ˆæœ¬è½¯ä»¶å…±å­˜ï¼Œä¸æ±¡æŸ“ç³»ç»Ÿï¼Œä¾‹å¦‚ Python2ã€Python3ï¼ŒRedis4.0ï¼ŒRedis5.0
- Windows ä¸Šä½“éªŒ/å­¦ä¹ å„ç§ Linux ç³»ç»Ÿ

### é‡è¦æ¦‚å¿µï¼šé•œåƒã€å®¹å™¨

**é•œåƒ**ï¼šå¯ä»¥ç†è§£ä¸ºè½¯ä»¶å®‰è£…åŒ…ï¼Œå¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œä¼ æ’­å’Œå®‰è£…ã€‚
**å®¹å™¨**ï¼šè½¯ä»¶å®‰è£…åçš„çŠ¶æ€ï¼Œæ¯ä¸ªè½¯ä»¶è¿è¡Œç¯å¢ƒéƒ½æ˜¯ç‹¬ç«‹çš„ã€éš”ç¦»çš„ï¼Œç§°ä¹‹ä¸ºå®¹å™¨ã€‚

### å®‰è£…

æ¡Œé¢ç‰ˆï¼šhttps://www.docker.com/products/docker-desktop
æœåŠ¡å™¨ç‰ˆï¼šhttps://docs.docker.com/engine/install/#server

### å¯åŠ¨æŠ¥é”™è§£å†³

æŠ¥é”™æˆªå›¾
![image.png](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/kvacsk82.png)

**è§£å†³æ–¹æ³•**ï¼š
æ§åˆ¶é¢æ¿->ç¨‹åº->å¯ç”¨æˆ–å…³é—­ windows åŠŸèƒ½ï¼Œå¼€å¯ Windows è™šæ‹ŸåŒ–å’Œ Linux å­ç³»ç»Ÿï¼ˆWSL2)
![image.png](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/kvactn57.png)

**å‘½ä»¤è¡Œå®‰è£… Linux å†…æ ¸**
`wsl.exe --install -d Ubuntu`

> ä½ ä¹Ÿå¯ä»¥æ‰“å¼€å¾®è½¯å•†åº— Microsoft Store æœç´¢ Linux è¿›è¡Œå®‰è£…ï¼Œé€‰æ‹©ä¸€ä¸ªæœ€æ–°ç‰ˆæœ¬çš„ Ubuntu æˆ–è€… Debian éƒ½å¯ä»¥

> ä¸Šé¢å‘½ä»¤å¾ˆå¯èƒ½ä½ å®‰è£…ä¸äº†ï¼Œå¾®è½¯å•†åº—ä½ ä¹Ÿå¯èƒ½æ‰“ä¸å¼€ï¼Œå¦‚æœé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå‚è€ƒï¼šhttps://blog.csdn.net/qq_42220935/article/details/104714114

**è®¾ç½®å¼€æœºå¯åŠ¨ Hypervisor**
`bcdedit /set hypervisorlaunchtype auto`

> æ³¨æ„è¦ç”¨ç®¡ç†å‘˜æƒé™æ‰“å¼€ PowerShell

**è®¾ç½®é»˜è®¤ä½¿ç”¨ç‰ˆæœ¬2**
`wsl.exe --set-default-version 2`

**æŸ¥çœ‹ WSL æ˜¯å¦å®‰è£…æ­£ç¡®**
`wsl.exe --list --verbose`
åº”è¯¥å¦‚ä¸‹å›¾ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ª Linux ç³»ç»Ÿï¼Œåå­—ä½ çš„ä¸ä¸€å®šè·Ÿæˆ‘çš„ä¸€æ ·ï¼Œçœ‹ä½ å®‰è£…çš„æ˜¯ä»€ä¹ˆç‰ˆæœ¬ã€‚
å¹¶ä¸” VERSION æ˜¯ 2
![image.png](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/ldxvkks2.png)

**ç¡®ä¿ BIOS å·²å¼€å¯è™šæ‹ŸåŒ–ï¼Œä¸‹å›¾æ£€æŸ¥æ˜¯å¦å·²å¼€å¯å¥½**

> å¦‚æœæ˜¯å·²ç¦ç”¨ï¼Œè¯·åœ¨å¼€æœºæ—¶æŒ‰ F2 è¿›å…¥ BIOS å¼€å¯ä¸€ä¸‹ï¼Œä¸ä¼šè®¾ç½®çš„å¯ä»¥ç½‘ä¸Šæœç´¢ä¸‹è‡ªå·±ä¸»æ¿çš„è®¾ç½®æ–¹æ³•ï¼ŒIntel å’Œ AMD çš„è®¾ç½®å¯èƒ½ç¨æœ‰ä¸åŒ

![image.png](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/kvaf7ody.png)

**å‡ºç°ä¸‹å›¾é”™è¯¯ï¼Œç‚¹å‡»é“¾æ¥å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ WSL2**
https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi
![image.png](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/kvajwvuw.png)

### é•œåƒåŠ é€Ÿæº

| é•œåƒåŠ é€Ÿå™¨          | é•œåƒåŠ é€Ÿå™¨åœ°å€                       |
| ------------------- | ------------------------------------ |
| Docker ä¸­å›½å®˜æ–¹é•œåƒ | https://registry.docker-cn.com       |
| DaoCloud é•œåƒç«™     | http://f1361db2.m.daocloud.io        |
| Azure ä¸­å›½é•œåƒ      | https://dockerhub.azk8s.cn           |
| ç§‘å¤§é•œåƒç«™          | https://docker.mirrors.ustc.edu.cn   |
| é˜¿é‡Œäº‘              | https://ud6340vz.mirror.aliyuncs.com |
| ä¸ƒç‰›äº‘              | https://reg-mirror.qiniu.com         |
| ç½‘æ˜“äº‘              | https://hub-mirror.c.163.com         |
| è…¾è®¯äº‘              | https://mirror.ccs.tencentyun.com    |

```
"registry-mirrors": ["https://registry.docker-cn.com"]
```

![1.png](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/l25jdwrn.png)

# ğŸ’»Docker å¿«é€Ÿå®‰è£…è½¯ä»¶

### ç›´æ¥å®‰è£…çš„ç¼ºç‚¹

- å®‰è£…éº»çƒ¦ï¼Œå¯èƒ½æœ‰å„ç§ä¾èµ–ï¼Œè¿è¡ŒæŠ¥é”™ã€‚ä¾‹å¦‚ï¼šWordPressï¼ŒElasticSearchï¼ŒRedisï¼ŒELK
- å¯èƒ½å¯¹ Windows å¹¶ä¸å‹å¥½ï¼Œè¿è¡Œæœ‰å„ç§å…¼å®¹é—®é¢˜ï¼Œè½¯ä»¶åªæ”¯æŒ Linux ä¸Šè·‘
- ä¸æ–¹ä¾¿å®‰è£…å¤šç‰ˆæœ¬è½¯ä»¶ï¼Œä¸èƒ½å…±å­˜ã€‚
- ç”µè„‘å®‰è£…äº†ä¸€å †è½¯ä»¶ï¼Œæ‹–æ…¢ç”µè„‘é€Ÿåº¦ã€‚
- ä¸åŒç³»ç»Ÿå’Œç¡¬ä»¶ï¼Œå®‰è£…æ–¹å¼ä¸ä¸€æ ·

> æœ¬æ–‡æ¡£è¯¾ä»¶é…å¥— [è§†é¢‘æ•™ç¨‹](https://www.bilibili.com/video/BV11L411g7U1?p=2)

### Docker å®‰è£…çš„ä¼˜ç‚¹

- ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥å®‰è£…å¥½ï¼Œå¿«é€Ÿæ–¹ä¾¿
- æœ‰å¤§é‡çš„é•œåƒï¼Œå¯ç›´æ¥ä½¿ç”¨
- æ²¡æœ‰ç³»ç»Ÿå…¼å®¹é—®é¢˜ï¼ŒLinux ä¸“äº«è½¯ä»¶ä¹Ÿç…§æ ·è·‘
- æ”¯æŒè½¯ä»¶å¤šç‰ˆæœ¬å…±å­˜
- ç”¨å®Œå°±ä¸¢ï¼Œä¸æ‹–æ…¢ç”µè„‘é€Ÿåº¦
- ä¸åŒç³»ç»Ÿå’Œç¡¬ä»¶ï¼Œåªè¦å®‰è£…å¥½ Docker å…¶ä»–éƒ½ä¸€æ ·äº†ï¼Œä¸€ä¸ªå‘½ä»¤æå®šæ‰€æœ‰

### æ¼”ç¤º Docker å®‰è£… Redis

Redis å®˜ç½‘ï¼šhttps://redis.io/

> å®˜ç½‘ä¸‹è½½å®‰è£…æ•™ç¨‹åªæœ‰æºç å®‰è£…æ–¹å¼ï¼Œæ²¡æœ‰ Windows ç‰ˆæœ¬ã€‚æƒ³è¦è‡ªå·±å®‰è£… windows ç‰ˆæœ¬éœ€è¦å»æ‰¾åˆ«äººç¼–è¯‘å¥½çš„å®‰è£…åŒ…ã€‚

Docker å®˜æ–¹é•œåƒä»“åº“æŸ¥æ‰¾ Redis ï¼šhttps://hub.docker.com/
![Dockeré•œåƒå®˜ç½‘](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/kv8zs4qr.png)

ä¸€ä¸ªå‘½ä»¤è·‘èµ·æ¥ï¼š`docker run -d -p 6379:6379 --name redis redis:latest`
å‘½ä»¤å‚è€ƒï¼šhttps://docs.docker.com/engine/reference/commandline/run/

![Dockerè¿è¡ŒRediså](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/kv8zy4xn.png)

### å®‰è£… Wordpress

é¦–å…ˆåˆ›å»ºä¸€ä¸ªdocker-compose.ymlæ–‡ä»¶å¤¹

![image-20240107182752036](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/20240107182753.png)

docker-compose.yml

```
version: '3.1'

services:

  wordpress:
    image: wordpress
    restart: always
    ports:
      - 8080:80
    environment:
      WORDPRESS_DB_HOST: db
      WORDPRESS_DB_USER: exampleuser
      WORDPRESS_DB_PASSWORD: examplepass
      WORDPRESS_DB_NAME: exampledb
    volumes:
      - wordpress:/var/www/html

  db:
    image: mysql:5.7
    restart: always
    environment:
      MYSQL_DATABASE: exampledb
      MYSQL_USER: exampleuser
      MYSQL_PASSWORD: examplepass
      MYSQL_RANDOM_ROOT_PASSWORD: '1'
    volumes:
      - db:/var/lib/mysql

volumes:
  wordpress:
  db:
```

```
docker-compose up -d
```

![image-20240107182659185](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/20240107182702.png)

### å®‰è£… ELK

```
docker run -p 5601:5601 -p 9200:9200 -p 5044:5044 -it --name elk sebp/elk
```

[å†…å­˜ä¸å¤Ÿè§£å†³æ–¹æ³•](https://docs.microsoft.com/en-us/windows/wsl/wsl-config#global-configuration-options-with-wslconfig)
è½¬åˆ°ç”¨æˆ·ç›®å½• `cd ~`ï¼Œè·¯å¾„ç±»ä¼¼è¿™ä¸ªï¼š`C:\Users\<UserName>`
åˆ›å»º `.wslconfig` æ–‡ä»¶å¡«å…¥ä»¥ä¸‹å†…å®¹

```
[wsl2]
memory=10GB # Limits VM memory in WSL 2 to 4 GB
processors=2 # Makes the WSL 2 VM use two virtual processors
```

ç”Ÿæ•ˆé…ç½®ï¼Œå‘½ä»¤è¡Œè¿è¡Œ `wsl --shutdown`

### æ›´å¤šç›¸å…³å‘½ä»¤

`docker ps` æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„å®¹å™¨
`docker images` æŸ¥çœ‹é•œåƒåˆ—è¡¨
`docker rm container-id` åˆ é™¤æŒ‡å®š id çš„å®¹å™¨
`docker stop/start container-id` åœæ­¢/å¯åŠ¨æŒ‡å®š id çš„å®¹å™¨
`docker rmi image-id` åˆ é™¤æŒ‡å®š id çš„é•œåƒ
`docker volume ls` æŸ¥çœ‹ volume åˆ—è¡¨
`docker network ls` æŸ¥çœ‹ç½‘ç»œåˆ—è¡¨

# ğŸ’½åˆ¶ä½œè‡ªå·±çš„é•œåƒ

### ä¸ºè‡ªå·±çš„ Web é¡¹ç›®æ„å»ºé•œåƒ

ç¤ºä¾‹é¡¹ç›®ä»£ç ï¼šhttps://github.com/gzyunke/test-docker
è¿™æ˜¯ä¸€ä¸ª Nodejs + Koa2 å†™çš„ Web é¡¹ç›®ï¼Œæä¾›äº†ç®€å•çš„ä¸¤ä¸ªæ¼”ç¤ºé¡µé¢ã€‚
è½¯ä»¶ä¾èµ–ï¼š[nodejs](https://nodejs.org/zh-cn/)
é¡¹ç›®ä¾èµ–åº“ï¼škoaã€log4jsã€koa-router

> æœ¬æ–‡æ¡£è¯¾ä»¶é…å¥— [è§†é¢‘æ•™ç¨‹](https://www.bilibili.com/video/BV11L411g7U1?p=3)

### ç¼–å†™ Dockerfile

Dockerfile æ˜¯ç”¨äºæ„å»º Docker é•œåƒçš„æ–‡æœ¬æ–‡ä»¶ã€‚å®ƒåŒ…å«ä¸€ç³»åˆ—æŒ‡ä»¤ï¼Œæ¯ä¸ªæŒ‡ä»¤ä»£è¡¨ä¸€ä¸ªæ„å»ºæ­¥éª¤ã€‚é€šè¿‡ç¼–å†™ Dockerfileï¼Œå¼€å‘è€…å¯ä»¥å®šä¹‰å®¹å™¨ä¸­çš„ç¯å¢ƒã€åº”ç”¨ç¨‹åºä¾èµ–å’Œå¯åŠ¨é…ç½®ç­‰ä¿¡æ¯ï¼Œä½¿å¾— Docker èƒ½å¤Ÿè‡ªåŠ¨æ„å»ºå‡ºç›¸åº”çš„é•œåƒã€‚

ä»¥ä¸‹æ˜¯ Dockerfile çš„ä¸»è¦ç”¨é€”å’ŒåŠŸèƒ½ï¼š

1. **å®šä¹‰åŸºç¡€é•œåƒï¼š** Dockerfile å…è®¸æŒ‡å®šä¸€ä¸ªåŸºç¡€é•œåƒï¼Œå³åœ¨æ„å»ºè¿‡ç¨‹ä¸­å°†è¦ä½¿ç”¨çš„èµ·å§‹ç‚¹ã€‚åŸºç¡€é•œåƒé€šå¸¸åŒ…å«äº†æ“ä½œç³»ç»Ÿå’Œä¸€äº›åŸºæœ¬çš„å·¥å…·ã€‚
2. **å®‰è£…ä¾èµ–ï¼š** é€šè¿‡ Dockerfileï¼Œä½ å¯ä»¥æŒ‡å®šåœ¨å®¹å™¨ä¸­å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„è½¯ä»¶ã€åº“å’Œä¾èµ–é¡¹ï¼Œç¡®ä¿åº”ç”¨ç¨‹åºåœ¨å®¹å™¨ä¸­è¿è¡Œæ—¶æ‹¥æœ‰æ‰€éœ€çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚
3. **æ‹·è´æ–‡ä»¶ï¼š** Dockerfile å…è®¸å°†æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ°å®¹å™¨ä¸­çš„æŒ‡å®šè·¯å¾„ã€‚è¿™ç”¨äºå°†åº”ç”¨ç¨‹åºä»£ç ã€é…ç½®æ–‡ä»¶ç­‰æ‹·è´åˆ°é•œåƒä¸­ã€‚
4. **è¿è¡Œå‘½ä»¤ï¼š** Dockerfile ä¸­å¯ä»¥åŒ…å«æ‰§è¡Œå‘½ä»¤çš„æŒ‡ä»¤ï¼Œä¾‹å¦‚åœ¨å®¹å™¨ä¸­æ‰§è¡Œå®‰è£…ã€é…ç½®ç­‰æ“ä½œã€‚è¿™äº›å‘½ä»¤å°†åœ¨æ„å»ºè¿‡ç¨‹ä¸­è‡ªåŠ¨æ‰§è¡Œã€‚
5. **è®¾ç½®ç¯å¢ƒå˜é‡ï¼š** é€šè¿‡ Dockerfileï¼Œå¯ä»¥è®¾ç½®å®¹å™¨ä¸­çš„ç¯å¢ƒå˜é‡ï¼Œä»¥ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚
6. **æš´éœ²ç«¯å£ï¼š** Dockerfile å…è®¸æŒ‡å®šå®¹å™¨ä¸­åº”ç”¨ç¨‹åºå°†ä½¿ç”¨çš„ç«¯å£ï¼Œå¹¶åœ¨æ„å»ºæ—¶å°†å…¶æš´éœ²å‡ºæ¥ï¼Œä»¥ä¾¿åœ¨è¿è¡Œæ—¶è¿›è¡Œç«¯å£æ˜ å°„ã€‚
7. **å®šä¹‰å¯åŠ¨å‘½ä»¤ï¼š** Dockerfile å…è®¸æŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶è¦æ‰§è¡Œçš„é»˜è®¤å‘½ä»¤ï¼Œä¾‹å¦‚å¯åŠ¨åº”ç”¨ç¨‹åºæˆ–æœåŠ¡ã€‚
8. **æ„å»ºè‡ªå®šä¹‰é•œåƒï¼š** ä½¿ç”¨ Dockerfileï¼Œå¯ä»¥æ ¹æ®é¡¹ç›®çš„éœ€æ±‚æ„å»ºè‡ªå®šä¹‰çš„ Docker é•œåƒï¼Œå…¶ä¸­åŒ…å«äº†æ‰€æœ‰å¿…è¦çš„ç»„ä»¶å’Œé…ç½®ã€‚



```
FROM node:11
MAINTAINER easydoc.net

# å¤åˆ¶ä»£ç 
ADD . /app

# è®¾ç½®å®¹å™¨å¯åŠ¨åçš„é»˜è®¤è¿è¡Œç›®å½•
WORKDIR /app

# è¿è¡Œå‘½ä»¤ï¼Œå®‰è£…ä¾èµ–
# RUN å‘½ä»¤å¯ä»¥æœ‰å¤šä¸ªï¼Œä½†æ˜¯å¯ä»¥ç”¨ && è¿æ¥å¤šä¸ªå‘½ä»¤æ¥å‡å°‘å±‚çº§ã€‚
# ä¾‹å¦‚ RUN npm install && cd /app && mkdir logs
RUN npm install --registry=https://registry.npm.taobao.org

# CMD æŒ‡ä»¤åªèƒ½ä¸€ä¸ªï¼Œæ˜¯å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤ï¼Œç®—æ˜¯ç¨‹åºçš„å…¥å£ã€‚
# å¦‚æœè¿˜éœ€è¦è¿è¡Œå…¶ä»–å‘½ä»¤å¯ä»¥ç”¨ && è¿æ¥ï¼Œä¹Ÿå¯ä»¥å†™æˆä¸€ä¸ªshellè„šæœ¬å»æ‰§è¡Œã€‚
# ä¾‹å¦‚ CMD cd /app && ./start.sh
CMD node app.js
```

[Dockerfileæ–‡æ¡£](https://docs.docker.com/engine/reference/builder/#run)

> å®ç”¨æŠ€å·§ï¼š
> å¦‚æœä½ å†™ Dockerfile æ—¶ç»å¸¸é‡åˆ°ä¸€äº›è¿è¡Œé”™è¯¯ï¼Œä¾èµ–é”™è¯¯ç­‰ï¼Œä½ å¯ä»¥ç›´æ¥è¿è¡Œä¸€ä¸ªä¾èµ–çš„åº•ï¼Œç„¶åè¿›å…¥ç»ˆç«¯è¿›è¡Œé…ç½®ç¯å¢ƒï¼ŒæˆåŠŸåå†æŠŠåšè¿‡çš„æ­¥éª¤å‘½ä»¤å†™é“ Dockerfile æ–‡ä»¶ä¸­ï¼Œè¿™æ ·ç¼–å†™è°ƒè¯•ä¼šå¿«å¾ˆå¤šã€‚
> ä¾‹å¦‚ä¸Šé¢çš„åº•æ˜¯`node:11`ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œ`docker run -it -d node:11 bash`ï¼Œè·‘èµ·æ¥åè¿›å…¥å®¹å™¨ç»ˆç«¯é…ç½®ä¾èµ–çš„è½¯ä»¶ï¼Œç„¶åå°è¯•è·‘èµ·æ¥è‡ªå·±çš„è½¯ä»¶ï¼Œæœ€åæŠŠæ‰€æœ‰åšè¿‡çš„æ­¥éª¤å†™å…¥åˆ° Dockerfile å°±å¥½äº†ã€‚
> æŒæ¡å¥½è¿™ä¸ªæŠ€å·§ï¼Œä½ çš„ Dockerfile æ–‡ä»¶ç¼–å†™èµ·æ¥å°±éå¸¸çš„å¾—å¿ƒåº”æ‰‹äº†ã€‚

### Build ä¸ºé•œåƒï¼ˆå®‰è£…åŒ…ï¼‰å’Œè¿è¡Œ

ç¼–è¯‘ `docker build -t test:v1 .`

> `-t` è®¾ç½®é•œåƒåå­—å’Œç‰ˆæœ¬å·
> å‘½ä»¤å‚è€ƒï¼šhttps://docs.docker.com/engine/reference/commandline/build/

è¿è¡Œ `docker run -p 8080:8080 --name test-hello test:v1`

> `-p` æ˜ å°„å®¹å™¨å†…ç«¯å£åˆ°å®¿ä¸»æœº
> `--name` å®¹å™¨åå­—
> `-d` åå°è¿è¡Œ
> å‘½ä»¤å‚è€ƒæ–‡æ¡£ï¼šhttps://docs.docker.com/engine/reference/run/

### æ›´å¤šç›¸å…³å‘½ä»¤

`docker ps` æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„å®¹å™¨
`docker images` æŸ¥çœ‹é•œåƒåˆ—è¡¨
`docker rm container-id` åˆ é™¤æŒ‡å®š id çš„å®¹å™¨
`docker stop/start container-id` åœæ­¢/å¯åŠ¨æŒ‡å®š id çš„å®¹å™¨
`docker rmi image-id` åˆ é™¤æŒ‡å®š id çš„é•œåƒ
`docker volume ls` æŸ¥çœ‹ volume åˆ—è¡¨
`docker network ls` æŸ¥çœ‹ç½‘ç»œåˆ—è¡¨

# ğŸ¥™ç›®å½•æŒ‚è½½

### ç°å­˜é—®é¢˜

- ä½¿ç”¨ Docker è¿è¡Œåï¼Œæˆ‘ä»¬æ”¹äº†é¡¹ç›®ä»£ç ä¸ä¼šç«‹åˆ»ç”Ÿæ•ˆï¼Œéœ€è¦é‡æ–°`build`å’Œ`run`ï¼Œå¾ˆæ˜¯éº»çƒ¦ã€‚
- å®¹å™¨é‡Œé¢äº§ç”Ÿçš„æ•°æ®ï¼Œä¾‹å¦‚ log æ–‡ä»¶ï¼Œæ•°æ®åº“å¤‡ä»½æ–‡ä»¶ï¼Œå®¹å™¨åˆ é™¤åå°±ä¸¢å¤±äº†ã€‚

> ç›®å½•æŒ‚è½½è§£å†³ä»¥ä¸Šé—®é¢˜

> æœ¬æ–‡æ¡£è¯¾ä»¶é…å¥— [è§†é¢‘æ•™ç¨‹](https://www.bilibili.com/video/BV11L411g7U1?p=4)

### å‡ ç§æŒ‚è½½æ–¹å¼

- `bind mount` ç›´æ¥æŠŠå®¿ä¸»æœºç›®å½•æ˜ å°„åˆ°å®¹å™¨å†…ï¼Œé€‚åˆæŒ‚ä»£ç ç›®å½•å’Œé…ç½®æ–‡ä»¶ã€‚å¯æŒ‚åˆ°å¤šä¸ªå®¹å™¨ä¸Š 
- `volume` ç”±å®¹å™¨åˆ›å»ºå’Œç®¡ç†ï¼Œåˆ›å»ºåœ¨å®¿ä¸»æœºï¼Œæ‰€ä»¥åˆ é™¤å®¹å™¨ä¸ä¼šä¸¢å¤±ï¼Œå®˜æ–¹æ¨èï¼Œæ›´é«˜æ•ˆï¼ŒLinux æ–‡ä»¶ç³»ç»Ÿï¼Œé€‚åˆå­˜å‚¨æ•°æ®åº“æ•°æ®ã€‚å¯æŒ‚åˆ°å¤šä¸ªå®¹å™¨ä¸Š æ ¼å¼ï¼š`æŒ‚è½½å‘½åï¼šdockeræŒ‚è½½è·¯å¾„` 
- `tmpfs mount` é€‚åˆå­˜å‚¨ä¸´æ—¶æ–‡ä»¶ï¼Œå­˜å®¿ä¸»æœºå†…å­˜ä¸­ã€‚ä¸å¯å¤šå®¹å™¨å…±äº«ã€‚

æ–‡æ¡£å‚è€ƒï¼šhttps://docs.docker.com/storage/

![image.png](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/kv96dc4q.png)

### æŒ‚è½½æ¼”ç¤º

```
bind mount` æ–¹å¼ç”¨ç»å¯¹è·¯å¾„ `-v D:/code:/app
volume` æ–¹å¼ï¼Œåªéœ€è¦ä¸€ä¸ªåå­— `-v db-data:/app
```

ç¤ºä¾‹ï¼š
`docker run -p 8080:8080 --name test-hello -v D:/code:/app -d test:v1`

> æ³¨æ„ï¼
> å› ä¸ºæŒ‚è½½åï¼Œå®¹å™¨é‡Œçš„ä»£ç å°±ä¼šæ›¿æ¢ä¸ºä½ æœ¬æœºçš„ä»£ç äº†ï¼Œå¦‚æœä½ ä»£ç ç›®å½•æ²¡æœ‰`node_modules`ç›®å½•ï¼Œä½ éœ€è¦åœ¨ä»£ç ç›®å½•æ‰§è¡Œä¸‹`npm install --registry=https://registry.npm.taobao.org`ç¡®ä¿ä¾èµ–åº“éƒ½å·²ç»å®‰è£…ï¼Œå¦åˆ™å¯èƒ½ä¼šæç¤ºâ€œError: Cannot find module â€˜koaâ€™â€
> å¦‚æœä½ çš„ç”µè„‘æ²¡æœ‰å®‰è£… [nodejs](https://nodejs.org/en/)ï¼Œä½ éœ€è¦å®‰è£…ä¸€ä¸‹æ‰èƒ½æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ã€‚

# ğŸ‘¨â€ğŸ‘¦â€ğŸ‘¦å¤šå®¹å™¨é€šä¿¡

### å­¦ä¹ ç›®æ ‡

é¡¹ç›®å¾€å¾€éƒ½ä¸æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œéœ€è¦æ•°æ®åº“ã€ç¼“å­˜è¿™äº›ä¸œè¥¿é…åˆè¿ä½œã€‚
è¿™èŠ‚æˆ‘ä»¬æŠŠå‰é¢çš„ Web é¡¹ç›®å¢åŠ ä¸€ä¸ª Redis ä¾èµ–ï¼Œå¤šè·‘ä¸€ä¸ª Redis å®¹å™¨ï¼Œæ¼”ç¤ºå¦‚ä½•å¤šå®¹å™¨ä¹‹é—´çš„é€šä¿¡ã€‚

> æœ¬æ–‡æ¡£è¯¾ä»¶é…å¥— [è§†é¢‘æ•™ç¨‹](https://www.bilibili.com/video/BV11L411g7U1?p=5)

### åˆ›å»ºè™šæ‹Ÿç½‘ç»œ

è¦æƒ³å¤šå®¹å™¨ä¹‹é—´äº’é€šï¼Œä» Web å®¹å™¨è®¿é—® Redis å®¹å™¨ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠä»–ä»¬æ”¾åˆ°åŒä¸ªç½‘ç»œä¸­å°±å¯ä»¥äº†ã€‚

æ–‡æ¡£å‚è€ƒï¼šhttps://docs.docker.com/engine/reference/commandline/network/

### æ¼”ç¤º

##### åˆ›å»ºä¸€ä¸ªåä¸º`test-net`çš„ç½‘ç»œï¼š

```
docker network create test-net
```

##### è¿è¡Œ Redis åœ¨ `test-net` ç½‘ç»œä¸­ï¼Œåˆ«å`redis`

```
docker run -d --name redis --network test-net --network-alias redis redis:latest
```

##### ä¿®æ”¹ä»£ç ä¸­è®¿é—®`redis`çš„åœ°å€ä¸ºç½‘ç»œåˆ«å

![image.png](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/kv98rfvb.png)

##### è¿è¡Œ Web é¡¹ç›®ï¼Œä½¿ç”¨åŒä¸ªç½‘ç»œ

```
docker run -p 8080:8080 --name test -v D:/test:/app --network test-net -d test:v1
```

##### æŸ¥çœ‹æ•°æ®

`http://localhost:8080/redis`
å®¹å™¨ç»ˆç«¯æŸ¥çœ‹æ•°æ®æ˜¯å¦ä¸€è‡´

### æ›´å¤šç›¸å…³å‘½ä»¤

`docker ps` æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„å®¹å™¨
`docker images` æŸ¥çœ‹é•œåƒåˆ—è¡¨
`docker rm container-id` åˆ é™¤æŒ‡å®š id çš„å®¹å™¨
`docker stop/start container-id` åœæ­¢/å¯åŠ¨æŒ‡å®š id çš„å®¹å™¨
`docker rmi image-id` åˆ é™¤æŒ‡å®š id çš„é•œåƒ
`docker volume ls` æŸ¥çœ‹ volume åˆ—è¡¨
`docker network ls` æŸ¥çœ‹ç½‘ç»œåˆ—è¡¨

# ğŸDocker-Compose

### ç°å­˜é—®é¢˜

åœ¨ä¸ŠèŠ‚ï¼Œæˆ‘ä»¬è¿è¡Œäº†ä¸¤ä¸ªå®¹å™¨ï¼šWeb é¡¹ç›® + Redis
å¦‚æœé¡¹ç›®ä¾èµ–æ›´å¤šçš„ç¬¬ä¸‰æ–¹è½¯ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ç®¡ç†çš„å®¹å™¨å°±æ›´åŠ å¤šï¼Œæ¯ä¸ªéƒ½è¦å•ç‹¬é…ç½®è¿è¡Œï¼ŒæŒ‡å®šç½‘ç»œã€‚
è¿™èŠ‚ï¼Œæˆ‘ä»¬ä½¿ç”¨ docker-compose æŠŠé¡¹ç›®çš„å¤šä¸ªæœåŠ¡é›†åˆåˆ°ä¸€èµ·ï¼Œä¸€é”®è¿è¡Œã€‚

> æœ¬æ–‡æ¡£è¯¾ä»¶é…å¥— [è§†é¢‘æ•™ç¨‹](https://www.bilibili.com/video/BV11L411g7U1?p=6)

### å®‰è£… Docker Compose

- å¦‚æœä½ æ˜¯å®‰è£…çš„æ¡Œé¢ç‰ˆ Dockerï¼Œä¸éœ€è¦é¢å¤–å®‰è£…ï¼Œå·²ç»åŒ…å«äº†ã€‚
- å¦‚æœæ˜¯æ²¡å›¾å½¢ç•Œé¢çš„æœåŠ¡å™¨ç‰ˆ Dockerï¼Œä½ éœ€è¦å•ç‹¬å®‰è£… [å®‰è£…æ–‡æ¡£](https://docs.docker.com/compose/install/#install-compose-on-linux-systems)
- è¿è¡Œ`docker-compose`æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ

### ç¼–å†™è„šæœ¬

è¦æŠŠé¡¹ç›®ä¾èµ–çš„å¤šä¸ªæœåŠ¡é›†åˆåˆ°ä¸€èµ·ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ª`docker-compose.yml`æ–‡ä»¶ï¼Œæè¿°ä¾èµ–å“ªäº›æœåŠ¡
å‚è€ƒæ–‡æ¡£ï¼šhttps://docs.docker.com/compose/

```
version: "3.7"

services:
  app:
    build: ./
    ports:
      - 80:8080
    volumes:
      - ./:/app
    environment:
      - TZ=Asia/Shanghai
  redis:
    image: redis:5.0.13
    volumes:
      - redis:/data
    environment:
      - TZ=Asia/Shanghai

volumes:
  redis:
```

> å®¹å™¨é»˜è®¤æ—¶é—´ä¸æ˜¯åŒ—äº¬æ—¶é—´ï¼Œå¢åŠ  TZ=Asia/Shanghai å¯ä»¥æ”¹ä¸ºåŒ—äº¬æ—¶é—´

### è·‘èµ·æ¥

åœ¨`docker-compose.yml` æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œæ‰§è¡Œï¼š`docker-compose up`å°±å¯ä»¥è·‘èµ·æ¥äº†ã€‚
å‘½ä»¤å‚è€ƒï¼šhttps://docs.docker.com/compose/reference/up/

åœ¨åå°è¿è¡Œåªéœ€è¦åŠ ä¸€ä¸ª -d å‚æ•°`docker-compose up -d`
æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ï¼š`docker-compose ps`
åœæ­¢è¿è¡Œï¼š`docker-compose stop`
é‡å¯ï¼š`docker-compose restart`
é‡å¯å•ä¸ªæœåŠ¡ï¼š`docker-compose restart service-name`
è¿›å…¥å®¹å™¨å‘½ä»¤è¡Œï¼š`docker-compose exec service-name sh`
æŸ¥çœ‹å®¹å™¨è¿è¡Œlogï¼š`docker-compose logs [service-name]`

# ğŸššå‘å¸ƒå’Œéƒ¨ç½²

### é•œåƒä»“åº“ä»‹ç»

é•œåƒä»“åº“ç”¨æ¥å­˜å‚¨æˆ‘ä»¬ build å‡ºæ¥çš„â€œå®‰è£…åŒ…â€ï¼ŒDocker å®˜æ–¹æä¾›äº†ä¸€ä¸ª [é•œåƒåº“](https://hub.docker.com/)ï¼Œé‡Œé¢åŒ…å«äº†å¤§é‡é•œåƒï¼ŒåŸºæœ¬å„ç§è½¯ä»¶æ‰€éœ€ä¾èµ–éƒ½æœ‰ï¼Œè¦ä»€ä¹ˆç›´æ¥ä¸Šå»æœç´¢ã€‚

æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠè‡ªå·± build å‡ºæ¥çš„é•œåƒä¸Šä¼ åˆ° docker æä¾›çš„é•œåƒåº“ä¸­ï¼Œæ–¹ä¾¿ä¼ æ’­ã€‚
å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ­å»ºè‡ªå·±çš„ç§æœ‰é•œåƒåº“ï¼Œæˆ–è€…ä½¿ç”¨å›½å†…å„ç§å¤§å‚æä¾›çš„é•œåƒæ‰˜ç®¡æœåŠ¡ï¼Œä¾‹å¦‚ï¼šé˜¿é‡Œäº‘ã€è…¾è®¯äº‘

> æœ¬æ–‡æ¡£è¯¾ä»¶é…å¥— [è§†é¢‘æ•™ç¨‹](https://www.bilibili.com/video/BV11L411g7U1?p=7)

### ä¸Šä¼ æˆ‘ä»¬çš„é•œåƒ

- é¦–å…ˆä½ è¦å…ˆ [æ³¨å†Œä¸€ä¸ªè´¦å·](https://hub.docker.com/)
- åˆ›å»ºä¸€ä¸ªé•œåƒåº“
  ![image.png](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/kv9a2wty.png)
- å‘½ä»¤è¡Œç™»å½•è´¦å·ï¼š
  `docker login -u username`
- æ–°å»ºä¸€ä¸ªtagï¼Œåå­—å¿…é¡»è·Ÿä½ æ³¨å†Œè´¦å·ä¸€æ ·
  `docker tag test:v1 username/test:v1`
- æ¨ä¸Šå»
  `docker push username/test:v1`
- éƒ¨ç½²è¯•ä¸‹
  `docker run -dp 8080:8080 username/test:v1`

##### docker-compose ä¸­ä¹Ÿå¯ä»¥ç›´æ¥ç”¨è¿™ä¸ªé•œåƒäº†

```
version: "3.7"

services:
  app:
#    build: ./
    image: helloguguji/test:v1
    ports:
      - 80:8080
    volumes:
      - ./:/app
    environment:
      - TZ=Asia/Shanghai
  redis:
    image: redis:5.0.13
    volumes:
      - redis:/data
    environment:
      - TZ=Asia/Shanghai

volumes:
  redis:
```

### é˜¿é‡Œäº‘å®¹å™¨æ‰˜ç®¡

docker å®˜æ–¹çš„é•œåƒæ‰˜ç®¡æœ‰æ—¶å€™ä¸Šä¼ å’Œä¸‹è½½éƒ½å¤ªæ…¢äº†ï¼Œå¦‚æœä½ æƒ³è¦æ›´å¿«çš„é€Ÿåº¦ï¼Œå¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘çš„å…è´¹é•œåƒæ‰˜ç®¡
ç™»å½• [é˜¿é‡Œäº‘](https://www.aliyun.com/)

![image.png](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/kv9dqxuo.png)

# ğŸ¯å¤‡ä»½å’Œè¿ç§»æ•°æ®

### è¿ç§»æ–¹å¼ä»‹ç»

å®¹å™¨ä¸­çš„æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰ç”¨æŒ‚è½½ç›®å½•ï¼Œåˆ é™¤å®¹å™¨åå°±ä¼šä¸¢å¤±æ•°æ®ã€‚
å‰é¢æˆ‘ä»¬å·²ç»è®²è§£äº†å¦‚ä½• [æŒ‚è½½ç›®å½•](doc:kze7f0ZR)
å¦‚æœä½ æ˜¯ç”¨`bind mount`ç›´æ¥æŠŠå®¿ä¸»æœºçš„ç›®å½•æŒ‚è¿›å»å®¹å™¨ï¼Œé‚£è¿ç§»æ•°æ®å¾ˆæ–¹ä¾¿ï¼Œç›´æ¥å¤åˆ¶ç›®å½•å°±å¥½äº†
å¦‚æœä½ æ˜¯ç”¨`volume`æ–¹å¼æŒ‚è½½çš„ï¼Œç”±äºæ•°æ®æ˜¯ç”±å®¹å™¨åˆ›å»ºå’Œç®¡ç†çš„ï¼Œéœ€è¦ç”¨ç‰¹æ®Šçš„æ–¹å¼æŠŠæ•°æ®å¼„å‡ºæ¥ã€‚

> æœ¬æ–‡æ¡£è¯¾ä»¶é…å¥— [è§†é¢‘æ•™ç¨‹](https://www.bilibili.com/video/BV11L411g7U1?p=8)

### å¤‡ä»½å’Œå¯¼å…¥ Volume çš„æµç¨‹

å¤‡ä»½ï¼š

- è¿è¡Œä¸€ä¸ª ubuntu çš„å®¹å™¨ï¼ŒæŒ‚è½½éœ€è¦å¤‡ä»½çš„ volume åˆ°å®¹å™¨ï¼Œå¹¶ä¸”æŒ‚è½½å®¿ä¸»æœºç›®å½•åˆ°å®¹å™¨é‡Œçš„å¤‡ä»½ç›®å½•ã€‚
- è¿è¡Œ tar å‘½ä»¤æŠŠæ•°æ®å‹ç¼©ä¸ºä¸€ä¸ªæ–‡ä»¶
- æŠŠå¤‡ä»½æ–‡ä»¶å¤åˆ¶åˆ°éœ€è¦å¯¼å…¥çš„æœºå™¨

å¯¼å…¥ï¼š

- è¿è¡Œ ubuntu å®¹å™¨ï¼ŒæŒ‚è½½å®¹å™¨çš„ volumeï¼Œå¹¶ä¸”æŒ‚è½½å®¿ä¸»æœºå¤‡ä»½æ–‡ä»¶æ‰€åœ¨ç›®å½•åˆ°å®¹å™¨é‡Œ
- è¿è¡Œ tar å‘½ä»¤è§£å‹å¤‡ä»½æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•

### å¤‡ä»½ MongoDB æ•°æ®æ¼”ç¤º

- è¿è¡Œä¸€ä¸ª mongodbï¼Œåˆ›å»ºä¸€ä¸ªåå«`mongo-data`çš„ volume æŒ‡å‘å®¹å™¨çš„ /data ç›®å½•
  `docker run -p 27018:27017 --name mongo -v mongo-data:/data -d mongo:4.4`
- è¿è¡Œä¸€ä¸ª Ubuntu çš„å®¹å™¨ï¼ŒæŒ‚è½½`mongo`å®¹å™¨çš„æ‰€æœ‰ volumeï¼Œæ˜ å°„å®¿ä¸»æœºçš„ backup ç›®å½•åˆ°å®¹å™¨é‡Œé¢çš„ /backup ç›®å½•ï¼Œç„¶åè¿è¡Œ tar å‘½ä»¤æŠŠæ•°æ®å‹ç¼©æ‰“åŒ…
  `docker run --rm --volumes-from mongo -v d:/backup:/backup ubuntu tar cvf /backup/backup.tar /data/`

æœ€åä½ å°±å¯ä»¥æ‹¿ç€è¿™ä¸ª backup.tar æ–‡ä»¶å»å…¶ä»–åœ°æ–¹å¯¼å…¥äº†ã€‚

### æ¢å¤ Volume æ•°æ®æ¼”ç¤º

- è¿è¡Œä¸€ä¸ª ubuntu å®¹å™¨ï¼ŒæŒ‚è½½ mongo å®¹å™¨çš„æ‰€æœ‰ volumesï¼Œç„¶åè¯»å– /backup ç›®å½•ä¸­çš„å¤‡ä»½æ–‡ä»¶ï¼Œè§£å‹åˆ° /data/ ç›®å½•
  `docker run --rm --volumes-from mongo -v d:/backup:/backup ubuntu bash -c "cd /data/ && tar xvf /backup/backup.tar --strip 1"`

> æ³¨æ„ï¼Œvolumes-from æŒ‡å®šçš„æ˜¯å®¹å™¨åå­—
> strip 1 è¡¨ç¤ºè§£å‹æ—¶å»æ‰å‰é¢1å±‚ç›®å½•ï¼Œå› ä¸ºå‹ç¼©æ—¶åŒ…å«äº†ç»å¯¹è·¯å¾„