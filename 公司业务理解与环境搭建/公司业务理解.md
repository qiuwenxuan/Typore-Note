## 公司部门分布图

![image-20231221100412393](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/20231221100413.png)

![image-20231221100415707](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/20231221100416.png)

## 1、公司项目

目前公司主流项目有四个

| 项目名称         | 产品                | 名称 |      |
| ---------------- | ------------------- | ---- | ---- |
| ALPS（阿尔卑斯） | DPU                 | fpga |      |
| Corsica          | DPU                 | Soc  |      |
| Create           | smart nic(智能网卡) | Soc  |      |
| green land       | CPU                 | Soc  |      |

## 2、项目环境

项目环境树状图：

![image-20231107113839674](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/image-20231107113839674.png)

![image-20231205113455687](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/20231205113456.png)

环境类型 SIM/EMU/HYBRID/CRB

- SIM环境为最开始的在vdi环境运行的测试用例环境
- EMU环境为PX2环境运行用例的环境
- Hybrid环境为最老版本用例的执行环境
- CRB环境为真实的电路板环境



在前端(host)设备的表现形式为

- ensX（网络组设备）
- vdX（存储设备）
- Nvme（块速存储设备）

后端N2设备类型的表现形式为

- legacy
- modern
- packed



# Trex发流业务理解

参考链接：[Trex 发流测试记录 - Vinny Yang - Confluence (jaguarmicro.com)](http://space.jaguarmicro.com/pages/viewpage.action?pageId=84992135#Trex发流测试记录-4.uplink-host场景时trex测试)

首先我们来看一下最简单的Trex发流测试`host-host场景时trex测试`

![image-20231120233727211](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/20231120233728.png)

存在两个虚拟机，应该是host端的VM,还有一个是N2端，现在我们对这几个端口都讲解

### host-VM (客户端虚拟机）

`host`表示`个人服务器`，为整个芯片发流架构的`前端`，在host前端有多个网络接口ensX

`Kernel内核`为host端的内核，内核上有如virbrX的虚拟化技术设备，通过virbr将host主机与N2上的ovs&dpdk



### N2 智能网卡/DPU

N2也称为智能网卡或DPU,是host主机上的一小部分,用于控制对外的macif接口的发流路径

N2内有一个`ovs&dpdk`的网络虚拟化和高性能数据包处理的技术,在ovs&dpdk里有一个`网桥br-ext`,该网桥上有多个对内的netX接口和对外的vnet接口，通过在N2内配置流表控制N2与host与macif口的发流交互。

`ovs（Open vSwitch）`

- Open vSwitch 是一个`用于虚拟化环境的开源虚拟交换机,它支持多个虚拟化平台（如KVM、Xen、VMware）和与物理网络的集成`。OVS 可以在虚拟机和物理网络之间提供灵活的网络连接，支持流表匹配、隧道技术、QoS（Quality of Service）等功能。

`DPDK (Data Plane Development Kit)`

- `DPDK 是一个用于构建高性能数据平面应用程序的开源工具集`。它提供了一组用户态的库和驱动程序，允许应用程序直接操作网络数据包，从而`实现更高的数据包处理性能`。DPDK 通常用于构建高性能的网络功能虚拟化（NFV）解决方案和数据平面应用程序。

`OVS 和 DPDK 的结合`

在某些情况下，OVS 可以与 DPDK 结合使用，以提高 OVS 的数据平面性能。通过使用 DPDK 加速，OVS 可以更有效地处理大量的网络数据包，提供更好的网络性能



## 测试组网理解

![image-20231225172728861](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/20231225172730.png)

一般我们的业务场景都是如Xnet-Xblk的设备发流

首先，blk设备在前端的表现形式，可以使用命令ls -l /sys/class/block/vd*存储设备block的生成。一般为vda~vdX

net设备在前端的表现形式，使用ls -l /sys/class/net查看网络设备的生成,一般为ensX...



blk设备的host和N2端的端口映射是以前端pcie与后端bdf号对应的，及前端与后端的设备名称类似，可能对应不上（如前端的vda可能对应后端的vdh），找好对应关系之后，修改fio发流文件，对发流文件传参发流

net设备的前后端映射关系，前端网口为ensX,后端的devlist的设备名一般为tmp_sock01...，需要将其转化为/tmp/sockX与网桥上的端口的iface值作对比，映射到网桥上的网络端口，然后配置流表发流

## 门槛用例测试组网图

![image-20240102162806459](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/20240102162807.png)

## 知识点总结

4.在N2上配置/etc/trex_cfg.yaml文件中interfaces的值为virtiouser0及virtiouser1，并UP两个端口
		ifconfig virtiouser0 up
		ifconfig virtiouser1 up
这两个口是我图中所指的这两个端口吗，这两个端口需要使用命令打开吗

![image-20231115153055439](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/image-20231115153055439.png)

解答：virtiouser0 和virtiouser1对应着新版本的macif0和macif1

![image-20231115155159615](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/image-20231115155159615.png)



1.host端-vm0获取virtio_net 的设备信息，并随机选出一个net 设备，包括dev_name,pcie_num,mac_addr。当中vm0是什么端口吗

![image-20231115153347701](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/image-20231115153347701.png)

解答：vm0并不是一个端口，而是host-VM虚机，在老版本可能一个用例涉及多个虚拟机，但现在只有一个虚拟机统称为VM
