仓库链接

```
ssh://git@bb.jaguarmicro.com:7999/jac/jmnd_sw_qa.git
```

文件路径：
1、jmnd_sw_qa/AutomatedScripts-Net/ovs-inline/inline-offload/ovs-match-act.robot
2、jmnd_sw_qa/AutomatedScripts-Net/ovs-inline/inline-offload/ovs-match-fwd.robot
3、jmnd_sw_qa/AutomatedScripts-Net/ovs-inline/inline-offload/ovs-match-mod.robot

![image-20240129165510286](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/20240129165513.png)

一键冒烟脚本：jmnd_sw_qa/smoke_script/smoke_release.sh

网络组环境部署

```
在104机子上下载每日构建的imu和业务版本
下载最新的网页版本：
wget --user=wenxuan.qiu --password=Njpj#04125617 /homehttps://jfrog1.jaguarmicro.com:443/artifactory/corsica-sw-generic-local/snapshot/full-version/corsica_dpu_dev/anolis/
业务版本：wget --user=wenxuan.qiu --password=Njpj#04125617 /home/smoke/ https://jfrog1.jaguarmicro.com/artifactory/corsica-sw-generic-local/snapshot/full-version/corsica_dpu_dev/anolis/202401312305/202401312305_jmnd.tar.gz

imu版本：wget --user=wenxuan.qiu --password=Njpj#04125617 ./ https://jfrog1.jaguarmicro.com/artifactory/corsica-sw-generic-local/snapshot/imu-version/corsica_dpu_dev/ubuntu/202401312300/crb_5_imu_flash_202401312300.img
解压业务版本在/home/smoke/下 为jmnd

拷贝imu在bmc上
sshpass -p 0penBmc scp -rp crb_5_imu_flash_202401312300.img root@10.21.183.72:/tmp
拷贝jmnd业务版本在N2上
sshpass -p root scp -rp jmnd/ root@10.21.183.73:/root

在BMC上升级IMU固件
/home/root/update_imu.sh /tmp/crb_5_imu_flash_202401312300.img

N2上
mv /usr/share/jmnd /usr/share/jmnd.bak
rm /usr/share/jmnd -fr
mv /root/jmnd /usr/share/jmnd
sync #强制立即将所有未写入磁盘的文件系统数据写入磁盘上

BMC上对N2上下电
./switch_init.sh

N2起业务版本
执行脚本：
./env-init.sh
脚本信息如下
echo 6 > /sys/kernel/mm/hugepages/hugepages-1048576kB/nr_hugepages
sysctl vm.nr_hugepages=8192
mkdir -p /dev/hugepages
mountpoint -q /dev/hugepages || mount -t hugetlbfs nodev /dev/hugepages
echo 1 > /sys/module/vfio/parameters/enable_unsafe_noiommu_mode
modprobe vfio-pci enable_unsafe_noiommu_mode=1
cd /usr/share/jmnd/single/debug_script/2net_0blk
./1_start_vdev.sh 200
./2_start_ovs.sh
./3_start_boot.sh

重启host
/usr/sbin/reboot

host启动trex发流服务
/root/trex/start_trex.sh
cd /root/trex;./start_trex.sh

或者
cd /root/trex/v2.93/
pkill -9 t-rex-64
nohup ./t-rex-64 -i --no-scapy-server --emu >./trex.log &

在104上运行冒烟测试
cd /home/smoke/jmnd_sw_qa/AutomatedScripts-Net
python pybot-cli.py  --loglevel DEBUG  --include ok -v sleep:3 -v fps:200 -s ovs-inline.inline-offload ovs-inline/
AutomatedScripts-Net\testlib\config\configsystem.robot

python -m robot --listener allure_robotframework:allure/output --loglevel DEBUG --include ok -v sleep:3 -v fps:200 -s ovs-inline.inline-offload ovs-inline/
```

配置文件

```
*** Variables ***
${dut1ip}         10.21.183.73  # dpu ip
${dut1port}       22
${dut1type}       linux
${dut2ip}         10.42.119.55  # 不用
${dut2port}       2002
${dut1user}       root
${dut1password}    root
${cha1ip}         10.21.183.79  # host(trex发流虚机) ip
${Tester}         trex  # 发流类型
${cha1port1}      101/0 # trex发流端口1
${cha1port2}      101/1 # trex发流端口2
${dut1port101}    net0  # ovs网桥对应host的ens1的端口
${dut1port102}    net1  # ovs网桥对应host的ens2的端口

```



1.首先下载网络组的测试用例 `ssh://git@bb.jaguarmicro.com:7999/jac/jmnd_sw_qa.git`在104虚拟机的/home/smoke目录下

2.进入到下载好的代码内，找到用例的配置文件模版

```
cd /home/smoke/jmnd_sw_qa/AutomatedScripts-Net/testlib/config
```

3.将配置模版文件复制一份在当前文件夹下，重命名为configsystem.robot,修改里面的配置为实际环境的配置信息

![image-20240202204514752](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/20240202204516.png)

![image-20240202205550144](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/20240202205551.png)

4.执行脚本文件`copy_file.sh`分别传入SCP,IMU，业务版本下载路径，将业务版本文件下载并解压到当前文件夹

![image-20240202205948741](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/20240202205950.png)

5.执行start_new.sh脚本，传入三个文件名参数分别为 SCP,IMU，jmnd自动化一键部署冒烟用例

![image-20240202211054952](http://wenxuanqiu.oss-cn-nanjing.aliyuncs.com/img/20240202211056.png)
